# ZFS

## 파일시스템이란?

파일 시스템은 컴퓨터에서 파일이나 자료를 쉽게 발견 및 접근 할 수 있도록 보관 또는 조직하는 체계를 가리키는 말이다.

파일 시스템은 통상 하드 디스크나 CD-ROM 같은 실제 자료 보관 장치를 사용하여 파일의 물리적 소재를 관리하는 것을 가리키나
네트워크 프로토콜을 수행하는 클라이언트를 통하여 파일 서버 상의 자료로의 접근을 제공하는 방식과 가상의 형태로서 접근 수단만이 존재하는 방식도 
파일 시스템의 범위를 포함 될 수 있다.

파일 시스템은 일반적으로 크기가 일정한 블록들의 배열에 접근 할 수 있는 자료 보관 장치위에 생성되어 이러한 배열들을 조직함으로 파일이나 디렉터리를
만들며 어느 부분이 파일이고 어느 부분이 공백인지를 구분하기 위하여 각 배열에 표시를 해 둔다. 또한 자료를 클러스터 또는 블록이라고 불리는 일정한 단위에
새겨 넣는데 이것이 바로 파일 하나가 필요로 하는 디스크의 최소 공간이다.

## 파일 시스템의 종류

### 데이터베이스 파일 시스템

데이터베이스 기반의 파일 시스템은 최근에 등장한 새로운 개념의 파일 시스템이다. 파일을 계층구조로 관리하지않고 파일의 형식, 주제, 만든이, 내용과 같은
여러 특성에 따라 시스템에서 자동으로 분류하여 관리하는 것이다. 

### 트랜잭션 기반 파일 시스템

트랜잭션 기반 파일 시스템은 파일에 일어난 이벤트나 트랜잭션을 기록하는 시스템이다. 사용자가 수행하는 작업은 여러 개의 파일의 내용을 바꿀 수 있다.
이 바뀐 내용들은 서로 연관되어 있는 경우가 많으므로 이 내용들이 논리적으로 서로 연결되어 있어야하는 시스템에서는 이 변화들이 동시에 일어난다는 것이
보장되어야 한다. 트랜잭션 기반 시스템은 이렇게 논리적으로 동시에 수행되어야하는 작업들을 하나의 트랜잭션으로 묶어 만약의 사고가 일어났을때 양쪽에
트랜잭션을 다시 수행하여 오류를 막는다. 또한 모든 트랜잭션은 기록으로 남아 어디서 무슨 일이 언제 수행되었는지가 기록된다. 이러한 파일 시스템은
시스템의 오류를 막기 위해 설계되었으며, 느리지만 안전하다고 볼 수 있다.

## ZFS 란?

ZFS(ZettaByte File System) 파일시스템은 제프 본윅(Jeff Bonwick)에 의해 구현되고 디자인 되었다. ZFS는 파일시스템을 관리하는 방법을
근본적으로 바꾸어 새로운 파일 시스템을 구현하였으며, ZFS의 이름에서 알 수 있듯이 거의 무한대의 저장소 용량을 가질 수 있고 표준 `POSIX` 파일시스템을 따르고 있고,
기존 파일시스템보다 관리가 간편하다. 기존의 파일 시스템은 볼륨과 파티션, 파티션의 관리. 파일시스템 확장 및 축소등 많은 작업이 필요했지만 ZFS에서는 이런 작업들을 간단히 할 수 있다.
 ZFS는 파일시스템과 볼륨매니저가 분리되어 있지않고 통합되어 있다.
 
ZFS 파일시스템은 현존하는 유일한 128비트 파일시스템으로 ZFS가 채택한 128비트 파일 시스템구조는 기존의 32~64비트 파일시스템의 160억 배에 이르는 방대한 볼륨 크기를
가능하게 하여 최근 리눅스 2.6 커널에서 차용한 SGI의 64비트 파일 시스템인 XFS와 비교하는 것이 의미가 없을 정도로 스토리지 성능을 거의 무한대로 
확장하였다. ZFS는 안정성을 기반으로 기존의 유닉스 파일시스템을 대체하기 위해 탄생한 파일시스템이다.

### 1. 스토리지 풀

기존의 파일시스템은 물리적인 스토리지에 볼륨을 생성하거나 RAID를 구축하기 위해 별도의 볼륨매니저를 사용하는데 기존 파일시스템의 볼륨 구성방식을 이용하여
확장 시에 서비스의 다운타임이 발생 할 수 밖에 없었다. 볼륨의 레이아웃을 변경하기 위해 디스크 추가 등의 작업이 발생되어도 마찬가지로 다운타임이 발생한다.
그러나 ZFS에서는 물리적인 스토리지를 관리하기 위해서 볼륨을 생성하는 대신에 스토리지 풀이라는 개념을 사용한다. 스토리지 풀을 이용하면 용량을 추가한 직후 
바로 반영되어 즉시 사용가능하다. 또한 모든 파일시스템이 스토리지풀로 구성된 스토리지에 담겨질 수 있고, 각각의 파일시스템은 실제로 사용한 만큼만 공간을
차지하기 때문에 스토리지 공간을 효율적으로 사용 할 수 있다.

